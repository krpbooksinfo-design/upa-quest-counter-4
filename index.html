<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¦ãƒ‘ã‚¯ã‚¨ã‚¹ãƒˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</title>
<style>
body{margin:0;padding:10px;font-family:sans-serif;background:#f6f6f6}
.box{background:#fff;border-radius:12px;padding:10px;margin-bottom:10px}
.top{position:relative;text-align:center}
.full{font-size:32px;font-weight:bold}
.row{display:flex;gap:10px}
.left,.right{flex:1}
button{font-size:18px;padding:10px;margin:4px}
.small{font-size:13px}
input{width:100%;font-size:24px;text-align:right}
@media(max-width:600px){.row{flex-direction:column}}

 /* ã‚¹ã‚­ãƒ«è¡¨ç¤º */
#skillOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
#skillBox{
  background:#fff;
  border-radius:12px;
  padding:10px;
  max-width:90%;
  max-height:90%;
  text-align:center;
}
#skillBox img{
  max-width:100%;
  max-height:70vh;
}
</style>
</head>
<body>

<div class="top box">
  <div class="full">ãƒ•ãƒ«ãƒ‘ãƒ¯ãƒ¼ï¼š<span id="fullPower">0</span></div>
  <button class="small" id="muteBtn" style="position:absolute;right:10px;top:10px">ğŸ”Š</button>
</div>

<div class="row">
  <div class="left">
    <div class="box">
      ãƒ‘ãƒ¯ãƒ¼ï¼š<span id="power">0</span><br>
      <span class="small">ã²ã¨ã¤å‰ï¼š<span id="powerPrev">0</span></span>
    </div>

    <div class="box">
      <input id="disp" value="0" readonly>
      <div>
        <button onclick="press('7')">7</button><button onclick="press('8')">8</button><button onclick="press('9')">9</button><button onclick="press('+')">+</button>
      </div>
      <div>
        <button onclick="press('4')">4</button><button onclick="press('5')">5</button><button onclick="press('6')">6</button><button onclick="press('-')">-</button>
      </div>
      <div>
        <button onclick="press('1')">1</button><button onclick="press('2')">2</button><button onclick="press('3')">3</button><button onclick="press('*')">Ã—</button>
      </div>
      <div>
        <button onclick="press('0')">0</button><button onclick="press('00')">00</button><button onclick="equal()">=</button><button onclick="clearDisp()">C</button>
      </div>
    </div>

    <button onclick="fullCalc()">ãƒ•ãƒ«ãƒ‘ãƒ¯ãƒ¼ï¼</button>
    <button class="small" onclick="undo()">ã²ã¨ã¤ã¾ãˆã«æˆ»ã™</button>
    <button class="small" onclick="allClear()">ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢</button>
    <button class="small" onclick="openSkill()">ã‚¹ã‚­ãƒ«ã‹ãã«ã‚“</button>
  </div>

  <div class="right">
    <div class="box">
      ãªã‹ã¾ï¼š<span id="friends">1</span><br>
      <button onclick="changeFriends(1)">ï¼‹</button>
      <button onclick="changeFriends(-1)">ï¼</button>
    </div>

    <div class="box">
      ğŸ² ã‚µã‚¤ã‚³ãƒ­<br>
      <span id="dice">-</span><br>
      <button onclick="rollDice()">ãµã‚‹</button>
    </div>

    <div class="box">
      ğŸª™ ã‚³ã‚¤ãƒ³ãƒˆã‚¹<br>
      <span id="coin">-</span><br>
      <button onclick="flipCoin()">ãªã’ã‚‹</button>
    </div>
  </div>
</div>

<!-- ã‚¹ã‚­ãƒ«ç”»é¢ -->
<div id="skillOverlay">
  <div id="skillBox">
    <img src="skill.png" alt="ã‚¹ã‚­ãƒ«">
    <br>
    <button onclick="closeSkill()">ã¨ã˜ã‚‹</button>
  </div>
</div>

<script>
// ---- çŠ¶æ…‹ ----
let dispVal='0'
let power=0
let history=[]
let friends=1
let muted=false
let skillOpen=false

// ---- åŠ¹æœéŸ³ ----
const seCoin=new Audio('coin.m4a')
const seDice=new Audio('dice.m4a')
const seFull=new Audio('full.m4a')
const seClick=new Audio('click.m4a')
function play(se){if(!muted){se.currentTime=0;se.play()}}

// ---- ãƒŸãƒ¥ãƒ¼ãƒˆ ----
muteBtn.onclick=function(){
  muted=!muted
  this.textContent=muted?'ğŸ”‡':'ğŸ”Š'
}

// ---- ã‚¹ã‚­ãƒ« ----
function openSkill(){
  skillOpen=true
  skillOverlay.style.display='flex'
}
function closeSkill(){
  skillOpen=false
  skillOverlay.style.display='none'
}

// ---- é›»å“ ----
function press(v){
  if(skillOpen)return
  play(seClick)
  if(dispVal==='0')dispVal=''
  dispVal+=v
  disp.value=dispVal
}
function clearDisp(){
  if(skillOpen)return
  dispVal='0'
  disp.value=dispVal
}
function equal(){
  if(skillOpen)return
  let r
  try{r=eval(dispVal)}catch(e){return}
  history.push(power)
  power+=r
  if(power>999999)power=999999
  updatePower()
  clearDisp()
}

function updatePower(){
  powerSpan.textContent=power
  powerPrev.textContent=history.length?history[history.length-1]:0
}

function undo(){
  if(skillOpen)return
  if(history.length){
    power=history.pop()
    updatePower()
  }
}

// ---- ãªã‹ã¾ ----
function changeFriends(v){
  if(skillOpen)return
  play(seClick)
  friends+=v
  if(friends<1)friends=1
  if(friends>99)friends=99
  friendsSpan.textContent=friends
}

// ---- ãƒ•ãƒ«ãƒ‘ãƒ¯ãƒ¼ ----
function fullCalc(){
  if(skillOpen)return
  play(seFull)
  fullPower.textContent=Math.min(9999999,power*friends)
}

// ---- ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢ ----
function allClear(){
  if(skillOpen)return
  if(!confirm('ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ'))return
  dispVal='0'
  power=0
  history=[]
  friends=1
  disp.value='0'
  powerSpan.textContent=0
  powerPrev.textContent=0
  friendsSpan.textContent=1
  fullPower.textContent=0
}

// ---- ã‚µã‚¤ã‚³ãƒ­ ----
function rollDice(){
  if(skillOpen)return
  play(seDice)
  let i=setInterval(()=>{dice.textContent=Math.floor(Math.random()*6)+1},100)
  setTimeout(()=>{clearInterval(i);dice.textContent=Math.floor(Math.random()*6)+1},1000)
}

// ---- ã‚³ã‚¤ãƒ³ãƒˆã‚¹ ----
function flipCoin(){
  if(skillOpen)return
  play(seCoin)
  let i=setInterval(()=>{coin.textContent=Math.random()<0.5?'ãŠã‚‚ã¦':'ã†ã‚‰'},100)
  setTimeout(()=>{clearInterval(i);coin.textContent=Math.random()<0.5?'ãŠã‚‚ã¦':'ã†ã‚‰'},1000)
}

// ---- DOMçŸ­ç¸® ----
const disp=document.getElementById('disp')
const powerSpan=document.getElementById('power')
const powerPrev=document.getElementById('powerPrev')
const friendsSpan=document.getElementById('friends')
</script>
</body>
</html>
